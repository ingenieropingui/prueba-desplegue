{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useCallback } from 'react';\nimport scrapedEvents from '../data/scraped_events.json';\n// Build an indexed structure eventsData[City][Category] => [events]\nfunction inferCityFromEvent(e) {\n  const url = (e.url || '').toLowerCase();\n  if ((e.source || '').toLowerCase().includes('pablotobon') || url.includes('medellin') || url.includes('medell')) return 'MedellÃ­n';\n  if ((e.source || '').toLowerCase().includes('astor') || url.includes('bogota') || url.includes('bogot')) return 'BogotÃ¡';\n  if (url.includes('cali')) return 'Cali';\n  if (url.includes('bucaramanga')) return 'Bucaramanga';\n  if (url.includes('cartagena')) return 'Cartagena';\n  if (url.includes('barranquilla')) return 'Barranquilla';\n  // fallback unknown\n  return 'BogotÃ¡';\n}\nfunction inferCategoryFromEvent(e) {\n  const text = ((e.tipo || '') + ' ' + (e.nombre || e.titulo || '') + ' ' + (e.descripcion || '')).toLowerCase();\n  if (text.match(/m(usica|Ãºsica)|conciert|band|orquesta|cantante|cantor/)) return 'MÃºsica';\n  if (text.match(/teatro|obra|drama|monÃ³logo|monolog/)) return 'Culturales';\n  if (text.match(/conferencia|congreso|foro|seminar|seminario|charla/)) return 'Conferencias';\n  if (text.match(/deporte|futbol|baloncesto|carrera|maraton|marat[oÃ³]n/)) return 'Deportes';\n  // fallback: if tipo field suggests teatro vs musica\n  const tipo = (e.tipo || '').toLowerCase();\n  if (tipo.includes('mus') || tipo.includes('mÃºsica')) return 'MÃºsica';\n  if (tipo.includes('teatro')) return 'Culturales';\n  return 'Culturales';\n}\nfunction buildEventsIndex(arr) {\n  const out = {};\n  arr.forEach(raw => {\n    const city = inferCityFromEvent(raw);\n    const category = inferCategoryFromEvent(raw);\n    // keep original fields but normalize common aliases and ensure url/lugar exist\n    const ev = Object.assign({}, raw);\n    ev.nombre = raw.nombre || raw.titulo || ev.nombre || '';\n    ev.fecha = raw.fecha || ev.fecha || null;\n    ev.hora = raw.hora || ev.hora || null;\n    ev.lugar = raw.lugar || raw.ubicacion || ev.lugar || '' || '';\n    ev.descripcion = raw.descripcion || raw.summary || ev.descripcion || '';\n    ev.url = raw.url || raw.link || ev.url || '';\n    out[city] = out[city] || {};\n    out[city][category] = out[city][category] || [];\n    out[city][category].push(ev);\n  });\n  return out;\n}\nconst eventsData = buildEventsIndex(scrapedEvents);\nimport { genId, formatDate, parseIntent, sleep } from '../utils/chatHelpers';\n\n// NOTE: Do not change selector names or external classes. This module is pure logic.\n\n// Derivar dinÃ¡micamente las ciudades y categorÃ­as a partir de los datos scrapeados\nfunction getCities() {\n  return Object.keys(eventsData).sort();\n}\nfunction getCategoriesForCity(city) {\n  if (!city) return [];\n  return Object.keys(eventsData[city] || {}).sort();\n}\nexport function useChatBot() {\n  _s();\n  const PAGE_SIZE = 5; // configurable page size (mostrar X por acciÃ³n) â€” ahora mostramos varios eventos por peticiÃ³n\n\n  const [open, setOpen] = useState(true);\n  const [state, setState] = useState('idle'); // idle | esperandoCiudad | esperandoCategoria | mostrandoEventos\n  const [selectedCity, setSelectedCity] = useState(null);\n  const [selectedCategory, setSelectedCategory] = useState(null);\n  const [messages, setMessages] = useState(() => [{\n    id: genId('msg'),\n    sender: 'ia',\n    text: 'Â¡Hola! Soy tu asistente de eventos â€” encantado de ayudarte. Â¿En quÃ© ciudad te gustarÃ­a buscar?',\n    time: new Date().toISOString()\n  }]);\n  const [isTyping, setIsTyping] = useState(false);\n\n  // pagination index per city|category key\n  const [pages, setPages] = useState({});\n  // keep a pending city context when bot asked for category but selectedCity may not be set yet\n  const [pendingCity, setPendingCity] = useState(null);\n  const pushMessage = useCallback((sender, text) => {\n    const msg = {\n      id: genId('msg'),\n      sender,\n      text,\n      time: new Date().toISOString()\n    };\n    setMessages(m => [...m, msg]);\n    return msg;\n  }, []);\n\n  // Helper to simulate typing and then send one or multiple bot messages\n  const botReply = useCallback((items = [], delay = 600) => {\n    // items: array of message objects to push after typing\n    (async () => {\n      setIsTyping(true);\n      // push typing indicator (UI will render the animated dots)\n      const typingId = genId('typing');\n      setMessages(m => [...m, {\n        id: typingId,\n        sender: 'ia',\n        type: 'typing',\n        text: 'Un momento, busco lo mejor para ti ðŸ˜Š'\n      }]);\n      await sleep(delay);\n      // remove typing indicator and append items\n      setMessages(prev => prev.filter(x => x.id !== typingId).concat(items.map(it => ({\n        id: genId('msg'),\n        sender: 'ia',\n        ...it,\n        time: new Date().toISOString()\n      }))));\n      setIsTyping(false);\n    })();\n  }, []);\n  const listCities = useCallback(() => {\n    setState('esperandoCiudad');\n    // send a text prompt listing cities (conversational, user must type the city name)\n    const cities = getCities();\n    botReply([{\n      text: `Selecciona una ciudad: ${cities.join(', ')}. Escribe el nombre de la ciudad para continuar.`\n    }], 700);\n  }, [pushMessage]);\n  const listCategories = useCallback(city => {\n    setState('esperandoCategoria');\n    setPendingCity(city);\n    const cats = getCategoriesForCity(city);\n    const catsText = cats.length ? cats.join(', ') : 'No hay categorÃ­as predefinidas para esta ciudad; puedes escribir palabras como MÃºsica, Teatro, Deportes.';\n    botReply([{\n      text: `Has seleccionado ${city}. Â¿QuÃ© categorÃ­a quieres ver? ${catsText}. Escribe la categorÃ­a.`\n    }], 700);\n  }, [pushMessage]);\n  const showEvents = useCallback((city, category) => {\n    setState('mostrandoEventos');\n    setSelectedCity(city);\n    setSelectedCategory(category);\n    const key = `${city}|${category}`;\n    const cityData = eventsData[city] || {};\n    const list = cityData[category] || [];\n\n    // initialize page index if needed\n    setPages(p => ({\n      ...p,\n      [key]: p[key] ? p[key] : 0\n    }));\n    if (list.length === 0) {\n      botReply([{\n        text: `Ups â€” no encuentro ${category} en ${city} ahora mismo. Puedes escribir otra ciudad, otra categorÃ­a, o \"volver\" para reiniciar.`\n      }], 600);\n      return;\n    }\n\n    // show PAGE_SIZE items starting from pages[key]\n    // read current page index from state (pages may have been initialized above)\n    const start = pages[key] || 0;\n    const slice = list.slice(start, start + PAGE_SIZE);\n    const items = [];\n    // Use a neutral, non-counting intro to avoid revealing small totals.\n    items.push({\n      text: `AquÃ­ tienes algunos eventos en ${category} Â· ${city}:`\n    });\n    slice.forEach(ev => {\n      // return the full event object as stored in the index, but format fecha\n      const formatted = Object.assign({}, ev);\n      try {\n        formatted.fecha = formatDate(ev.fecha);\n      } catch (err) {\n        formatted.fecha = ev.fecha || null;\n      }\n      items.push({\n        type: 'event',\n        payload: formatted\n      });\n    });\n    // guidance for next steps (conversational)\n    const guidance = [];\n    if (start + PAGE_SIZE < list.length) guidance.push('Si quieres ver mÃ¡s, escribe \"ver mÃ¡s\".');\n    guidance.push('Para cambiar de ciudad escribe el nombre de la ciudad. Escribe \"volver\" para volver al inicio.');\n    items.push({\n      text: guidance.join(' ')\n    });\n    botReply(items, 800);\n  }, [pushMessage]);\n  // note: showEvents depends on pages state (used to compute start index). We rely\n  // on reading `pages` directly inside the callback so include it in the dependency\n  // chain where this hook is recreated when pages changes. To avoid linter noise\n  // we could list [pushMessage, pages], but we intentionally keep the body simple\n  // and update pages via setPages when advancing. If you see stale page indices,\n  // we can refactor to accept an explicit page offset parameter.\n\n  const handleText = useCallback(text => {\n    if (!text || !text.trim()) return;\n    const t = text.trim();\n    pushMessage('user', t);\n    // use parseIntent from helpers\n    const intent = parseIntent(t);\n\n    // If parser returned a confidence score, use it to decide clarifications\n    const confidence = typeof intent.confidence === 'number' ? intent.confidence : 1.0;\n\n    // Merge parsed city/category into conversation state (do not overwrite existing unless explicit change requested)\n    const parsedCity = intent.city || null;\n    const parsedCategory = intent.category || null;\n\n    // helpers to map parsed tokens into canonical keys used by eventsData\n    function mapCity(raw) {\n      if (!raw) return null;\n      // prefer normalizeCityName if it maps\n      const byName = normalizeCityName(raw);\n      if (byName && eventsData[byName]) return byName;\n      const target = normalizeString(raw);\n      for (const k of Object.keys(eventsData)) {\n        if (normalizeString(k).startsWith(target)) return k;\n      }\n      return byName || capitalizeFirst(raw);\n    }\n    function mapCategory(raw, cityForLookup) {\n      if (!raw) return null;\n      // if we have a city, prefer finding a category key within that city\n      if (cityForLookup) {\n        const found = findCategoryKeyForCity(cityForLookup, raw);\n        if (found) return found;\n      }\n      // otherwise search globally across cities for a matching category key\n      const target = normalizeString(raw);\n      for (const cityKey of Object.keys(eventsData)) {\n        const cats = Object.keys(eventsData[cityKey] || {});\n        for (const c of cats) {\n          if (normalizeString(c).startsWith(target) || normalizeString(c) === target) return c;\n        }\n      }\n      // fallback: return capitalized raw\n      return capitalizeFirst(raw);\n    }\n\n    // Determine mapped values (do not commit to state yet)\n    const mappedCity = parsedCity ? mapCity(parsedCity) : null;\n    const mappedCategory = parsedCategory ? mapCategory(parsedCategory, mappedCity || selectedCity) : null;\n\n    // detect explicit change request keywords in user's message (approximate)\n    const lowerRaw = (t || '').toLowerCase();\n    const explicitChange = /\\b(cambiar|cambio|cambia|nuevo|otra ciudad|otra categoria|otra categorÃ­a|cambiar a)\\b/.test(lowerRaw);\n\n    // Apply parsed city if we don't have one yet or user explicitly asked to change\n    if (mappedCity) {\n      if (!selectedCity) {\n        setSelectedCity(mappedCity);\n      } else if (selectedCity !== mappedCity && explicitChange) {\n        setSelectedCity(mappedCity);\n      }\n    }\n\n    // Apply parsed category if we don't have one yet or user explicitly asked to change\n    if (mappedCategory) {\n      if (!selectedCategory) {\n        setSelectedCategory(mappedCategory);\n      } else if (selectedCategory !== mappedCategory && explicitChange) {\n        setSelectedCategory(mappedCategory);\n      }\n    }\n\n    // If after applying parsed tokens we have both city and category, perform immediate search\n    const finalCity = mappedCity || selectedCity;\n    const finalCategory = mappedCategory || selectedCategory;\n    if (finalCity && finalCategory) {\n      // ensure pagination cursor reset for this pair\n      const key = `${finalCity}|${finalCategory}`;\n      setPages(p => ({\n        ...p,\n        [key]: 0\n      }));\n      setSelectedCity(finalCity);\n      setSelectedCategory(finalCategory);\n      // Show first event immediately\n      botReply([{\n        text: `Perfecto â€” buscando ${finalCategory} en ${finalCity}...`\n      }], 400);\n      // slight delay then show events (showEvents will simulate typing too)\n      setTimeout(() => showEvents(finalCity, finalCategory), 600);\n      return;\n    }\n\n    // If user typed a city name as free text, map to a known city using eventsData\n    if (!mappedCity && !selectedCity) {\n      // try to match raw text to a city present in eventsData\n      const candidate = Object.keys(eventsData).find(k => normalizeString(k) === normalizeString(t) || normalizeString(k).startsWith(normalizeString(t)));\n      if (candidate) {\n        // ask for category for that city\n        listCategories(candidate);\n        return;\n      }\n    }\n\n    // If we only have category, ask for city\n    if ((mappedCategory || selectedCategory) && !(mappedCity || selectedCity)) {\n      const catToAsk = mappedCategory || selectedCategory;\n      botReply([{\n        text: `Â¿En quÃ© ciudad quieres buscar ${catToAsk}? Por ejemplo BogotÃ¡, MedellÃ­n, Cali o Bucaramanga.`\n      }], 500);\n      return;\n    }\n\n    // If we only have city, ask for category\n    if ((mappedCity || selectedCity) && !(mappedCategory || selectedCategory)) {\n      const cityToAsk = mappedCity || selectedCity;\n      botReply([{\n        text: `Genial â€” Â¿quÃ© categorÃ­a te interesa en ${cityToAsk} (por ejemplo MÃºsica, Deportes, Culturales)?`\n      }], 500);\n      return;\n    }\n    if (intent.intent === 'list_cities') {\n      listCities();\n      return;\n    }\n    // greetings -> friendly human reply and open question\n    if (intent.intent === 'greeting') {\n      botReply([{\n        text: 'Â¡Hola! ðŸ˜Š Â¿En quÃ© ciudad te gustarÃ­a buscar eventos o escribe \"buscar <texto>\" para una bÃºsqueda rÃ¡pida?'\n      }], 500);\n      return;\n    }\n    if (intent.intent === 'help') {\n      botReply([{\n        text: 'Puedo ayudarte a encontrar eventos. Prueba escribir: \"ver ciudades\", \"buscar <texto>\", el nombre de una ciudad (p.e. BogotÃ¡), \"ver mÃ¡s\" o \"volver\" para reiniciar.'\n      }], 600);\n      return;\n    }\n    // user asked to see events -> start the city selection flow\n    if (intent.intent === 'list_events') {\n      listCities();\n      return;\n    }\n    if (intent.intent === 'restart') {\n      restart();\n      return;\n    }\n    if (intent.intent === 'show_more') {\n      selectOption('showMore');\n      return;\n    }\n    if (intent.intent === 'search_query') {\n      // show intermediate typing message\n      botReply([{\n        text: `Perfecto â€” busco \"${intent.query}\"...`\n      }], 500);\n      // do a search across events and show first match (paged)\n      const q = intent.query.toLowerCase();\n      const results = [];\n      Object.keys(eventsData).forEach(city => {\n        Object.keys(eventsData[city]).forEach(cat => {\n          eventsData[city][cat].forEach(ev => {\n            const hay = `${ev.nombre} ${ev.artista || ''} ${ev.lugar || ''} ${ev.descripcion || ''}`.toLowerCase();\n            if (hay.includes(q)) results.push({\n              city,\n              category: cat,\n              event: ev\n            });\n          });\n        });\n      });\n      if (results.length === 0) {\n        botReply([{\n          text: `No encontrÃ© nada para \"${intent.query}\". Â¿Quieres que muestre ciudades, intentes otra bÃºsqueda o pidas ayuda? Escribe ver ciudades, buscar <texto> o ayuda.`\n        }], 800);\n      } else {\n        // show first found as event (and set pagination state for that city|category)\n        const r = results[0];\n        const city = capitalizeFirst(r.city);\n        const cat = capitalizeFirst(r.category);\n        // set pages index so showMore continues in that list\n        const key = `${city}|${cat}`;\n        setPages(p => ({\n          ...p,\n          [key]: 0\n        }));\n        botReply([{\n          text: `Resultado para \"${intent.query}\" en ${city} â€” ${cat}:`\n        }, {\n          type: 'event',\n          payload: {\n            ...r.event,\n            fecha: formatDate(r.event.fecha)\n          }\n        }, {\n          text: 'Escribe \"ver mÃ¡s\" para ver otro resultado, o \"volver\" para reiniciar.'\n        }], 700);\n      }\n      return;\n    }\n    if (intent.intent === 'search') {\n      // robust mapping: normalize keys (remove accents) and match\n      const wantedCity = normalizeString(intent.city);\n      const wantedCat = normalizeString(intent.category);\n      let cityKey = null;\n      for (const k of Object.keys(eventsData)) {\n        if (normalizeString(k).startsWith(wantedCity)) {\n          cityKey = k;\n          break;\n        }\n      }\n      let categoryKey = null;\n      if (cityKey) {\n        categoryKey = findCategoryKeyForCity(cityKey, intent.category) || Object.keys(eventsData[cityKey]).find(k => normalizeString(k).startsWith(wantedCat));\n      }\n      if (cityKey && categoryKey) {\n        // show first event and setup pagination for the proper key names\n        const catDisplay = categoryKey;\n        const pageKey = `${cityKey}|${catDisplay}`;\n        setPages(p => ({\n          ...p,\n          [pageKey]: 0\n        }));\n        setSelectedCity(cityKey);\n        setSelectedCategory(catDisplay);\n        showEvents(cityKey, catDisplay);\n      } else {\n        const cityPretty = capitalizeFirst(intent.city);\n        const catPretty = capitalizeFirst(intent.category);\n        botReply([{\n          text: `Lo siento â€” no tengo toda la info exacta para ${cityPretty} y ${catPretty} ahora mismo. Escribe \"ver ciudades\" para ver opciones o intenta otra bÃºsqueda.`\n        }], 600);\n      }\n      return;\n    }\n    if (intent.intent === 'choose_city') {\n      // normalize incoming city name\n      const rawCity = intent.city;\n      const city = capitalizeFirst(rawCity);\n\n      // If we already had a selected city, user is switching city mid-conversation\n      if (selectedCity && selectedCity !== city) {\n        // Attempt to preserve category filter if possible\n        if (selectedCategory) {\n          const validCat = findCategoryKeyForCity(city, selectedCategory);\n          if (validCat) {\n            // Reset pagination for new city+category then show first page\n            const key = `${city}|${validCat}`;\n            setPages(p => ({\n              ...p,\n              [key]: 0\n            }));\n            setSelectedCity(city);\n            setSelectedCategory(validCat);\n            botReply([{\n              text: `Perfecto â€” ahora busco eventos en ${city}. Mantengo la categorÃ­a ${validCat}.`\n            }], 600);\n            // show first item\n            showEvents(city, validCat);\n            return;\n          } else {\n            // category not available in new city: inform and offer alternatives\n            setSelectedCity(city);\n            setSelectedCategory(null);\n            const available = getCategoriesForCity(city);\n            const options = available.length ? available.concat(['Ver todos']) : ['MÃºsica', 'Culturales', 'Deportes', 'Conferencias'];\n            botReply([{\n              text: `CambiÃ© a ${city}, pero no encontrÃ© la categorÃ­a ${selectedCategory} allÃ­.`\n            }, {\n              text: `Puedes elegir otra categorÃ­a: ${options.join(', ')}. Escribe la categorÃ­a que prefieras.`\n            }], 700);\n            return;\n          }\n        }\n        // No category to preserve â€” just update city and ask what to do next\n        setSelectedCity(city);\n        setPendingCity(null);\n        const cityCats = getCategoriesForCity(city);\n        const catsText = cityCats.length ? cityCats.join(', ') : 'MÃºsica, Culturales, Deportes, Conferencias';\n        botReply([{\n          text: `Perfecto â€” ahora busco eventos en ${city}. Â¿QuÃ© categorÃ­a te interesa? ${catsText}. Escribe la categorÃ­a.`\n        }], 600);\n        return;\n      }\n\n      // default behavior (no selectedCity previously): show categories for chosen city\n      listCategories(city);\n      return;\n    }\n    if (intent.intent === 'choose_category') {\n      const rawCat = intent.category;\n      // find a valid category key in the currently selected city or pendingCity\n      const cityForLookup = selectedCity || pendingCity;\n      const validCat = cityForLookup ? findCategoryKeyForCity(cityForLookup, rawCat) : null;\n      if (validCat && cityForLookup) {\n        // reset pagination for this city|category\n        const key = `${cityForLookup}|${validCat}`;\n        setPages(p => ({\n          ...p,\n          [key]: 0\n        }));\n        setSelectedCategory(validCat);\n        setSelectedCity(cityForLookup);\n        showEvents(cityForLookup, validCat);\n      } else if (selectedCity && !validCat) {\n        // selected city exists but category not found there\n        const available = getCategoriesForCity(selectedCity);\n        const options = available.length ? available.concat(['Ver todos']) : ['MÃºsica', 'Culturales', 'Deportes', 'Conferencias'];\n        botReply([{\n          text: `No encontrÃ© la categorÃ­a solicitada en ${selectedCity}. Puedes elegir otra categorÃ­a: ${options.join(', ')}. Escribe la que prefieras.`\n        }], 600);\n      } else {\n        const cities = getCities();\n        botReply([{\n          text: `Has pedido la categorÃ­a ${capitalizeFirst(rawCat)}. Primero, selecciona una ciudad: ${cities.join(', ')}. Escribe la ciudad.`\n        }], 600);\n      }\n      return;\n    }\n    // fallback: use confidence to decide whether to clarify or perform a best-effort\n    if (confidence < 0.6) {\n      botReply([{\n        text: 'No estoy seguro de quÃ© quieres decir â€” Â¿Quieres que muestre ciudades, buscar por texto o ver ayuda? Escribe \"ver ciudades\", \"buscar <texto>\" o \"ayuda\".'\n      }], 600);\n    } else {\n      // try a friendly fallback that asks a clarifying question\n      botReply([{\n        text: 'Â¿Quieres que muestre ciudades, busque por texto o te muestre ayuda? Escribe ver ciudades, buscar <texto> o ayuda.'\n      }], 600);\n    }\n  }, [listCities, listCategories, pushMessage, selectedCity, showEvents]);\n\n  // API requested: sendText, selectOption, resetConversation\n  const sendText = useCallback(text => {\n    handleText(text);\n  }, [handleText]);\n  const selectOption = useCallback((type, value) => {\n    // type: 'city'|'category'|'action'|'showMore'\n    if (type === 'city') {\n      selectCity(value);\n      return;\n    }\n    if (type === 'category') {\n      selectCategory(value);\n      return;\n    }\n    if (type === 'action' && (value || '').toLowerCase().includes('volver')) {\n      restart();\n      return;\n    }\n    if (type === 'showMore' || type === 'action' && (value || '').toLowerCase().includes('ver m')) {\n      // advance pagination for current selection\n      const city = selectedCity;\n      const category = selectedCategory;\n      if (!city || !category) {\n        botReply([{\n          text: 'Primero selecciona una ciudad y categorÃ­a. Escribe \"ver ciudades\" para ver la lista de ciudades.'\n        }], 500);\n        return;\n      }\n      const key = `${city}|${category}`;\n      const cityData = eventsData[city] || {};\n      const list = cityData[category] || [];\n      const current = pages[key] || 0;\n      const next = current + PAGE_SIZE;\n      if (next >= list.length) {\n        botReply([{\n          text: `No hay mÃ¡s eventos en ${category} para ${city}. Puedes escribir otra categorÃ­a o ciudad, o \"volver\" para reiniciar.`\n        }], 600);\n        return;\n      }\n      // advance page index then show next PAGE_SIZE items\n      setPages(p => ({\n        ...p,\n        [key]: next\n      }));\n      // show events from next index\n      const slice = list.slice(next, next + PAGE_SIZE);\n      const items = [{\n        text: `AquÃ­ tienes mÃ¡s eventos en ${category} Â· ${city}:`\n      }];\n      slice.forEach(ev => items.push({\n        type: 'event',\n        payload: {\n          ...ev,\n          fecha: formatDate(ev.fecha)\n        }\n      }));\n      items.push({\n        text: next + PAGE_SIZE < list.length ? 'Escribe \"ver mÃ¡s\" para seguir viendo eventos.' : 'No quedan mÃ¡s eventos en esta lista. Escribe otra categorÃ­a o ciudad, o \"volver\".'\n      });\n      botReply(items, 700);\n      return;\n    }\n  }, [listCategories, pushMessage, showEvents, selectedCity, selectedCategory, pages, PAGE_SIZE, botReply]);\n\n  // helper functions local to hook\n  function capitalizeFirst(s) {\n    if (!s) return s;\n    return s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();\n  }\n  function normalizeString(s) {\n    if (!s) return '';\n    return s.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').trim();\n  }\n  function normalizeCityName(raw) {\n    if (!raw) return raw;\n    const r = raw.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n    if (r.startsWith('medell')) return 'MedellÃ­n';\n    if (r.startsWith('bogo')) return 'BogotÃ¡';\n    if (r.startsWith('cali')) return 'Cali';\n    if (r.startsWith('bucara')) return 'Bucaramanga';\n    if (r.startsWith('cart') || r.startsWith('cartag')) return 'Cartagena';\n    if (r.startsWith('barra') || r.startsWith('barran')) return 'Barranquilla';\n    return raw;\n  }\n\n  // find a category key in a city by comparing normalized strings (handles accents)\n  function findCategoryKeyForCity(city, catLike) {\n    if (!city || !catLike) return null;\n    const cityData = eventsData[city] || {};\n    const cats = Object.keys(cityData || {});\n    const target = catLike.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n    for (const k of cats) {\n      const nk = k.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      if (nk === target || nk.startsWith(target)) return k;\n    }\n    return null;\n  }\n  const selectCity = useCallback(city => {\n    if (!city) return;\n    setSelectedCity(city);\n    listCategories(city);\n  }, [listCategories]);\n  const selectCategory = useCallback(category => {\n    if (!category) return;\n    const cityToUse = selectedCity || pendingCity;\n    if (!cityToUse) {\n      pushMessage('ia', 'Primero, elige una ciudad para buscar.');\n      listCities();\n      return;\n    }\n    // clear pendingCity after consuming\n    setPendingCity(null);\n    showEvents(cityToUse, category);\n  }, [selectedCity, pendingCity, pushMessage, listCities, showEvents]);\n  const restart = useCallback(() => {\n    setState('idle');\n    setSelectedCity(null);\n    setSelectedCategory(null);\n    setMessages([{\n      id: genId('msg'),\n      sender: 'ia',\n      text: 'Â¡Hola de nuevo! Dime en quÃ© ciudad buscas y preparo algunas opciones para ti.',\n      time: new Date().toISOString()\n    }]);\n  }, []);\n  const toggleOpen = useCallback(() => setOpen(o => !o), []);\n  return {\n    open,\n    state,\n    selectedCity,\n    selectedCategory,\n    messages,\n    isTyping,\n    // API methods requested\n    sendText: sendText,\n    selectOption: selectOption,\n    resetConversation: restart,\n    toggleOpen,\n    // legacy actions object for UI compatibility\n    actions: {\n      pushMessage,\n      handleText,\n      listCities,\n      listCategories,\n      selectCity,\n      selectCategory,\n      showEvents,\n      restart,\n      toggleOpen,\n      // expose newer API on actions for backward compatibility\n      selectOption,\n      sendText,\n      resetConversation: restart\n    }\n  };\n}\n_s(useChatBot, \"FJDbS/sQPybzCwr2pg9vQBXnAi8=\");\nexport default useChatBot;","map":{"version":3,"names":["useState","useCallback","scrapedEvents","inferCityFromEvent","e","url","toLowerCase","source","includes","inferCategoryFromEvent","text","tipo","nombre","titulo","descripcion","match","buildEventsIndex","arr","out","forEach","raw","city","category","ev","Object","assign","fecha","hora","lugar","ubicacion","summary","link","push","eventsData","genId","formatDate","parseIntent","sleep","getCities","keys","sort","getCategoriesForCity","useChatBot","_s","PAGE_SIZE","open","setOpen","state","setState","selectedCity","setSelectedCity","selectedCategory","setSelectedCategory","messages","setMessages","id","sender","time","Date","toISOString","isTyping","setIsTyping","pages","setPages","pendingCity","setPendingCity","pushMessage","msg","m","botReply","items","delay","typingId","type","prev","filter","x","concat","map","it","listCities","cities","join","listCategories","cats","catsText","length","showEvents","key","cityData","list","p","start","slice","formatted","err","payload","guidance","handleText","trim","t","intent","confidence","parsedCity","parsedCategory","mapCity","byName","normalizeCityName","target","normalizeString","k","startsWith","capitalizeFirst","mapCategory","cityForLookup","found","findCategoryKeyForCity","cityKey","c","mappedCity","mappedCategory","lowerRaw","explicitChange","test","finalCity","finalCategory","setTimeout","candidate","find","catToAsk","cityToAsk","restart","selectOption","query","q","results","cat","hay","artista","event","r","wantedCity","wantedCat","categoryKey","catDisplay","pageKey","cityPretty","catPretty","rawCity","validCat","available","options","cityCats","rawCat","sendText","value","selectCity","selectCategory","current","next","s","charAt","toUpperCase","normalize","replace","catLike","nk","cityToUse","toggleOpen","o","resetConversation","actions"],"sources":["C:/Users/crist/OneDrive/Documents/Clonado fronted despliegue/prueba-desplegue/Proyecto-Integrador-fronted-main/src/components/ChatBotLogic.jsx"],"sourcesContent":["import { useState, useCallback } from 'react';\r\nimport scrapedEvents from '../data/scraped_events.json';\r\n// Build an indexed structure eventsData[City][Category] => [events]\r\nfunction inferCityFromEvent(e) {\r\n  const url = (e.url || '').toLowerCase();\r\n  if ((e.source || '').toLowerCase().includes('pablotobon') || url.includes('medellin') || url.includes('medell')) return 'MedellÃ­n';\r\n  if ((e.source || '').toLowerCase().includes('astor') || url.includes('bogota') || url.includes('bogot')) return 'BogotÃ¡';\r\n  if (url.includes('cali')) return 'Cali';\r\n  if (url.includes('bucaramanga')) return 'Bucaramanga';\r\n  if (url.includes('cartagena')) return 'Cartagena';\r\n  if (url.includes('barranquilla')) return 'Barranquilla';\r\n  // fallback unknown\r\n  return 'BogotÃ¡';\r\n}\r\n\r\nfunction inferCategoryFromEvent(e) {\r\n  const text = ((e.tipo || '') + ' ' + (e.nombre || e.titulo || '') + ' ' + (e.descripcion || '')).toLowerCase();\r\n  if (text.match(/m(usica|Ãºsica)|conciert|band|orquesta|cantante|cantor/)) return 'MÃºsica';\r\n  if (text.match(/teatro|obra|drama|monÃ³logo|monolog/)) return 'Culturales';\r\n  if (text.match(/conferencia|congreso|foro|seminar|seminario|charla/)) return 'Conferencias';\r\n  if (text.match(/deporte|futbol|baloncesto|carrera|maraton|marat[oÃ³]n/)) return 'Deportes';\r\n  // fallback: if tipo field suggests teatro vs musica\r\n  const tipo = (e.tipo || '').toLowerCase();\r\n  if (tipo.includes('mus') || tipo.includes('mÃºsica')) return 'MÃºsica';\r\n  if (tipo.includes('teatro')) return 'Culturales';\r\n  return 'Culturales';\r\n}\r\n\r\nfunction buildEventsIndex(arr) {\r\n  const out = {};\r\n  arr.forEach((raw) => {\r\n    const city = inferCityFromEvent(raw);\r\n    const category = inferCategoryFromEvent(raw);\r\n    // keep original fields but normalize common aliases and ensure url/lugar exist\r\n    const ev = Object.assign({}, raw);\r\n    ev.nombre = raw.nombre || raw.titulo || ev.nombre || '';\r\n    ev.fecha = raw.fecha || ev.fecha || null;\r\n    ev.hora = raw.hora || ev.hora || null;\r\n    ev.lugar = (raw.lugar || raw.ubicacion || ev.lugar || '') || '';\r\n    ev.descripcion = raw.descripcion || raw.summary || ev.descripcion || '';\r\n    ev.url = raw.url || raw.link || ev.url || '';\r\n    out[city] = out[city] || {};\r\n    out[city][category] = out[city][category] || [];\r\n    out[city][category].push(ev);\r\n  });\r\n  return out;\r\n}\r\n\r\nconst eventsData = buildEventsIndex(scrapedEvents);\r\nimport { genId, formatDate, parseIntent, sleep } from '../utils/chatHelpers';\r\n\r\n// NOTE: Do not change selector names or external classes. This module is pure logic.\r\n\r\n// Derivar dinÃ¡micamente las ciudades y categorÃ­as a partir de los datos scrapeados\r\nfunction getCities() {\r\n  return Object.keys(eventsData).sort();\r\n}\r\n\r\nfunction getCategoriesForCity(city) {\r\n  if (!city) return [];\r\n  return Object.keys(eventsData[city] || {}).sort();\r\n}\r\n\r\nexport function useChatBot() {\r\n  const PAGE_SIZE = 5; // configurable page size (mostrar X por acciÃ³n) â€” ahora mostramos varios eventos por peticiÃ³n\r\n\r\n  const [open, setOpen] = useState(true);\r\n  const [state, setState] = useState('idle'); // idle | esperandoCiudad | esperandoCategoria | mostrandoEventos\r\n  const [selectedCity, setSelectedCity] = useState(null);\r\n  const [selectedCategory, setSelectedCategory] = useState(null);\r\n  const [messages, setMessages] = useState(() => [\r\n    { id: genId('msg'), sender: 'ia', text: 'Â¡Hola! Soy tu asistente de eventos â€” encantado de ayudarte. Â¿En quÃ© ciudad te gustarÃ­a buscar?', time: new Date().toISOString() },\r\n  ]);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n\r\n  // pagination index per city|category key\r\n  const [pages, setPages] = useState({});\r\n  // keep a pending city context when bot asked for category but selectedCity may not be set yet\r\n  const [pendingCity, setPendingCity] = useState(null);\r\n\r\n  const pushMessage = useCallback((sender, text) => {\r\n    const msg = { id: genId('msg'), sender, text, time: new Date().toISOString() };\r\n    setMessages((m) => [...m, msg]);\r\n    return msg;\r\n  }, []);\r\n\r\n  // Helper to simulate typing and then send one or multiple bot messages\r\n  const botReply = useCallback((items = [], delay = 600) => {\r\n    // items: array of message objects to push after typing\r\n    (async () => {\r\n      setIsTyping(true);\r\n      // push typing indicator (UI will render the animated dots)\r\n      const typingId = genId('typing');\r\n      setMessages((m) => [...m, { id: typingId, sender: 'ia', type: 'typing', text: 'Un momento, busco lo mejor para ti ðŸ˜Š' }]);\r\n      await sleep(delay);\r\n      // remove typing indicator and append items\r\n      setMessages((prev) => prev.filter((x) => x.id !== typingId).concat(items.map((it) => ({ id: genId('msg'), sender: 'ia', ...it, time: new Date().toISOString() }))));\r\n      setIsTyping(false);\r\n    })();\r\n  }, []);\r\n\r\n  const listCities = useCallback(() => {\r\n    setState('esperandoCiudad');\r\n    // send a text prompt listing cities (conversational, user must type the city name)\r\n    const cities = getCities();\r\n    botReply([\r\n      { text: `Selecciona una ciudad: ${cities.join(', ')}. Escribe el nombre de la ciudad para continuar.` },\r\n    ], 700);\r\n  }, [pushMessage]);\r\n\r\n  const listCategories = useCallback((city) => {\r\n    setState('esperandoCategoria');\r\n    setPendingCity(city);\r\n    const cats = getCategoriesForCity(city);\r\n    const catsText = cats.length ? cats.join(', ') : 'No hay categorÃ­as predefinidas para esta ciudad; puedes escribir palabras como MÃºsica, Teatro, Deportes.';\r\n    botReply([\r\n      { text: `Has seleccionado ${city}. Â¿QuÃ© categorÃ­a quieres ver? ${catsText}. Escribe la categorÃ­a.` },\r\n    ], 700);\r\n  }, [pushMessage]);\r\n\r\n  const showEvents = useCallback((city, category) => {\r\n    setState('mostrandoEventos');\r\n    setSelectedCity(city);\r\n    setSelectedCategory(category);\r\n\r\n    const key = `${city}|${category}`;\r\n  const cityData = eventsData[city] || {};\r\n  const list = cityData[category] || [];\r\n\r\n    // initialize page index if needed\r\n    setPages((p) => ({ ...p, [key]: p[key] ? p[key] : 0 }));\r\n\r\n    if (list.length === 0) {\r\n      botReply([\r\n        { text: `Ups â€” no encuentro ${category} en ${city} ahora mismo. Puedes escribir otra ciudad, otra categorÃ­a, o \"volver\" para reiniciar.` },\r\n      ], 600);\r\n      return;\r\n    }\r\n\r\n    // show PAGE_SIZE items starting from pages[key]\r\n    // read current page index from state (pages may have been initialized above)\r\n    const start = (pages[key] || 0);\r\n    const slice = list.slice(start, start + PAGE_SIZE);\r\n    const items = [];\r\n    // Use a neutral, non-counting intro to avoid revealing small totals.\r\n    items.push({ text: `AquÃ­ tienes algunos eventos en ${category} Â· ${city}:` });\r\n    slice.forEach((ev) => {\r\n      // return the full event object as stored in the index, but format fecha\r\n      const formatted = Object.assign({}, ev);\r\n      try {\r\n        formatted.fecha = formatDate(ev.fecha);\r\n      } catch (err) {\r\n        formatted.fecha = ev.fecha || null;\r\n      }\r\n      items.push({ type: 'event', payload: formatted });\r\n    });\r\n    // guidance for next steps (conversational)\r\n    const guidance = [];\r\n    if (start + PAGE_SIZE < list.length) guidance.push('Si quieres ver mÃ¡s, escribe \"ver mÃ¡s\".');\r\n    guidance.push('Para cambiar de ciudad escribe el nombre de la ciudad. Escribe \"volver\" para volver al inicio.');\r\n    items.push({ text: guidance.join(' ') });\r\n    botReply(items, 800);\r\n  }, [pushMessage]);\r\n  // note: showEvents depends on pages state (used to compute start index). We rely\r\n  // on reading `pages` directly inside the callback so include it in the dependency\r\n  // chain where this hook is recreated when pages changes. To avoid linter noise\r\n  // we could list [pushMessage, pages], but we intentionally keep the body simple\r\n  // and update pages via setPages when advancing. If you see stale page indices,\r\n  // we can refactor to accept an explicit page offset parameter.\r\n\r\n  const handleText = useCallback((text) => {\r\n    if (!text || !text.trim()) return;\r\n    const t = text.trim();\r\n    pushMessage('user', t);\r\n    // use parseIntent from helpers\r\n    const intent = parseIntent(t);\r\n\r\n    // If parser returned a confidence score, use it to decide clarifications\r\n    const confidence = (typeof intent.confidence === 'number') ? intent.confidence : 1.0;\r\n\r\n    // Merge parsed city/category into conversation state (do not overwrite existing unless explicit change requested)\r\n    const parsedCity = intent.city || null;\r\n    const parsedCategory = intent.category || null;\r\n\r\n    // helpers to map parsed tokens into canonical keys used by eventsData\r\n    function mapCity(raw) {\r\n      if (!raw) return null;\r\n      // prefer normalizeCityName if it maps\r\n      const byName = normalizeCityName(raw);\r\n      if (byName && eventsData[byName]) return byName;\r\n      const target = normalizeString(raw);\r\n      for (const k of Object.keys(eventsData)) {\r\n        if (normalizeString(k).startsWith(target)) return k;\r\n      }\r\n      return byName || capitalizeFirst(raw);\r\n    }\r\n\r\n    function mapCategory(raw, cityForLookup) {\r\n      if (!raw) return null;\r\n      // if we have a city, prefer finding a category key within that city\r\n      if (cityForLookup) {\r\n        const found = findCategoryKeyForCity(cityForLookup, raw);\r\n        if (found) return found;\r\n      }\r\n      // otherwise search globally across cities for a matching category key\r\n      const target = normalizeString(raw);\r\n      for (const cityKey of Object.keys(eventsData)) {\r\n        const cats = Object.keys(eventsData[cityKey] || {});\r\n        for (const c of cats) {\r\n          if (normalizeString(c).startsWith(target) || normalizeString(c) === target) return c;\r\n        }\r\n      }\r\n      // fallback: return capitalized raw\r\n      return capitalizeFirst(raw);\r\n    }\r\n\r\n    // Determine mapped values (do not commit to state yet)\r\n    const mappedCity = parsedCity ? mapCity(parsedCity) : null;\r\n    const mappedCategory = parsedCategory ? mapCategory(parsedCategory, mappedCity || selectedCity) : null;\r\n\r\n    // detect explicit change request keywords in user's message (approximate)\r\n    const lowerRaw = (t || '').toLowerCase();\r\n    const explicitChange = /\\b(cambiar|cambio|cambia|nuevo|otra ciudad|otra categoria|otra categorÃ­a|cambiar a)\\b/.test(lowerRaw);\r\n\r\n    // Apply parsed city if we don't have one yet or user explicitly asked to change\r\n    if (mappedCity) {\r\n      if (!selectedCity) {\r\n        setSelectedCity(mappedCity);\r\n      } else if (selectedCity !== mappedCity && explicitChange) {\r\n        setSelectedCity(mappedCity);\r\n      }\r\n    }\r\n\r\n    // Apply parsed category if we don't have one yet or user explicitly asked to change\r\n    if (mappedCategory) {\r\n      if (!selectedCategory) {\r\n        setSelectedCategory(mappedCategory);\r\n      } else if (selectedCategory !== mappedCategory && explicitChange) {\r\n        setSelectedCategory(mappedCategory);\r\n      }\r\n    }\r\n\r\n    // If after applying parsed tokens we have both city and category, perform immediate search\r\n    const finalCity = mappedCity || selectedCity;\r\n    const finalCategory = mappedCategory || selectedCategory;\r\n    if (finalCity && finalCategory) {\r\n      // ensure pagination cursor reset for this pair\r\n      const key = `${finalCity}|${finalCategory}`;\r\n      setPages((p) => ({ ...p, [key]: 0 }));\r\n      setSelectedCity(finalCity);\r\n      setSelectedCategory(finalCategory);\r\n      // Show first event immediately\r\n      botReply([{ text: `Perfecto â€” buscando ${finalCategory} en ${finalCity}...` }], 400);\r\n      // slight delay then show events (showEvents will simulate typing too)\r\n      setTimeout(() => showEvents(finalCity, finalCategory), 600);\r\n      return;\r\n    }\r\n\r\n    // If user typed a city name as free text, map to a known city using eventsData\r\n    if (!mappedCity && !selectedCity) {\r\n      // try to match raw text to a city present in eventsData\r\n      const candidate = Object.keys(eventsData).find(k => normalizeString(k) === normalizeString(t) || normalizeString(k).startsWith(normalizeString(t)));\r\n      if (candidate) {\r\n        // ask for category for that city\r\n        listCategories(candidate);\r\n        return;\r\n      }\r\n    }\r\n\r\n    // If we only have category, ask for city\r\n    if ((mappedCategory || selectedCategory) && !(mappedCity || selectedCity)) {\r\n      const catToAsk = mappedCategory || selectedCategory;\r\n      botReply([{ text: `Â¿En quÃ© ciudad quieres buscar ${catToAsk}? Por ejemplo BogotÃ¡, MedellÃ­n, Cali o Bucaramanga.` }], 500);\r\n      return;\r\n    }\r\n\r\n    // If we only have city, ask for category\r\n    if ((mappedCity || selectedCity) && !(mappedCategory || selectedCategory)) {\r\n      const cityToAsk = mappedCity || selectedCity;\r\n      botReply([{ text: `Genial â€” Â¿quÃ© categorÃ­a te interesa en ${cityToAsk} (por ejemplo MÃºsica, Deportes, Culturales)?` }], 500);\r\n      return;\r\n    }\r\n\r\n    if (intent.intent === 'list_cities') { listCities(); return; }\r\n    // greetings -> friendly human reply and open question\r\n    if (intent.intent === 'greeting') {\r\n      botReply([{ text: 'Â¡Hola! ðŸ˜Š Â¿En quÃ© ciudad te gustarÃ­a buscar eventos o escribe \"buscar <texto>\" para una bÃºsqueda rÃ¡pida?' }], 500);\r\n      return;\r\n    }\r\n    if (intent.intent === 'help') {\r\n      botReply([\r\n        { text: 'Puedo ayudarte a encontrar eventos. Prueba escribir: \"ver ciudades\", \"buscar <texto>\", el nombre de una ciudad (p.e. BogotÃ¡), \"ver mÃ¡s\" o \"volver\" para reiniciar.' }\r\n      ], 600);\r\n      return;\r\n    }\r\n    // user asked to see events -> start the city selection flow\r\n    if (intent.intent === 'list_events') { listCities(); return; }\r\n    if (intent.intent === 'restart') { restart(); return; }\r\n    if (intent.intent === 'show_more') { selectOption('showMore'); return; }\r\n\r\n    if (intent.intent === 'search_query') {\r\n      // show intermediate typing message\r\n      botReply([{ text: `Perfecto â€” busco \"${intent.query}\"...` }], 500);\r\n      // do a search across events and show first match (paged)\r\n      const q = intent.query.toLowerCase();\r\n      const results = [];\r\n      Object.keys(eventsData).forEach((city) => {\r\n        Object.keys(eventsData[city]).forEach((cat) => {\r\n          eventsData[city][cat].forEach((ev) => {\r\n            const hay = `${ev.nombre} ${ev.artista || ''} ${ev.lugar || ''} ${ev.descripcion || ''}`.toLowerCase();\r\n            if (hay.includes(q)) results.push({ city, category: cat, event: ev });\r\n          });\r\n        });\r\n      });\r\n      if (results.length === 0) {\r\n        botReply([{ text: `No encontrÃ© nada para \"${intent.query}\". Â¿Quieres que muestre ciudades, intentes otra bÃºsqueda o pidas ayuda? Escribe ver ciudades, buscar <texto> o ayuda.` }], 800);\r\n      } else {\r\n        // show first found as event (and set pagination state for that city|category)\r\n        const r = results[0];\r\n        const city = capitalizeFirst(r.city);\r\n        const cat = capitalizeFirst(r.category);\r\n        // set pages index so showMore continues in that list\r\n        const key = `${city}|${cat}`;\r\n        setPages((p) => ({ ...p, [key]: 0 }));\r\n        botReply([{ text: `Resultado para \"${intent.query}\" en ${city} â€” ${cat}:` }, { type: 'event', payload: { ...r.event, fecha: formatDate(r.event.fecha) } }, { text: 'Escribe \"ver mÃ¡s\" para ver otro resultado, o \"volver\" para reiniciar.' }], 700);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (intent.intent === 'search') {\r\n      // robust mapping: normalize keys (remove accents) and match\r\n      const wantedCity = normalizeString(intent.city);\r\n      const wantedCat = normalizeString(intent.category);\r\n      let cityKey = null;\r\n      for (const k of Object.keys(eventsData)) {\r\n        if (normalizeString(k).startsWith(wantedCity)) { cityKey = k; break; }\r\n      }\r\n      let categoryKey = null;\r\n      if (cityKey) {\r\n        categoryKey = findCategoryKeyForCity(cityKey, intent.category) || Object.keys(eventsData[cityKey]).find(k => normalizeString(k).startsWith(wantedCat));\r\n      }\r\n      if (cityKey && categoryKey) {\r\n        // show first event and setup pagination for the proper key names\r\n        const catDisplay = categoryKey;\r\n        const pageKey = `${cityKey}|${catDisplay}`;\r\n        setPages((p) => ({ ...p, [pageKey]: 0 }));\r\n        setSelectedCity(cityKey);\r\n        setSelectedCategory(catDisplay);\r\n        showEvents(cityKey, catDisplay);\r\n      } else {\r\n        const cityPretty = capitalizeFirst(intent.city);\r\n        const catPretty = capitalizeFirst(intent.category);\r\n        botReply([{ text: `Lo siento â€” no tengo toda la info exacta para ${cityPretty} y ${catPretty} ahora mismo. Escribe \"ver ciudades\" para ver opciones o intenta otra bÃºsqueda.` }], 600);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (intent.intent === 'choose_city') {\r\n      // normalize incoming city name\r\n      const rawCity = intent.city;\r\n      const city = capitalizeFirst(rawCity);\r\n\r\n      // If we already had a selected city, user is switching city mid-conversation\r\n      if (selectedCity && selectedCity !== city) {\r\n        // Attempt to preserve category filter if possible\r\n        if (selectedCategory) {\r\n          const validCat = findCategoryKeyForCity(city, selectedCategory);\r\n          if (validCat) {\r\n            // Reset pagination for new city+category then show first page\r\n            const key = `${city}|${validCat}`;\r\n            setPages((p) => ({ ...p, [key]: 0 }));\r\n            setSelectedCity(city);\r\n            setSelectedCategory(validCat);\r\n            botReply([{ text: `Perfecto â€” ahora busco eventos en ${city}. Mantengo la categorÃ­a ${validCat}.` }], 600);\r\n            // show first item\r\n            showEvents(city, validCat);\r\n            return;\r\n          } else {\r\n            // category not available in new city: inform and offer alternatives\r\n            setSelectedCity(city);\r\n            setSelectedCategory(null);\r\n            const available = getCategoriesForCity(city);\r\n            const options = available.length ? available.concat(['Ver todos']) : ['MÃºsica', 'Culturales', 'Deportes', 'Conferencias'];\r\n            botReply([\r\n              { text: `CambiÃ© a ${city}, pero no encontrÃ© la categorÃ­a ${selectedCategory} allÃ­.` },\r\n                { text: `Puedes elegir otra categorÃ­a: ${options.join(', ')}. Escribe la categorÃ­a que prefieras.` },\r\n            ], 700);\r\n            return;\r\n          }\r\n        }\r\n  // No category to preserve â€” just update city and ask what to do next\r\n  setSelectedCity(city);\r\n  setPendingCity(null);\r\n  const cityCats = getCategoriesForCity(city);\r\n  const catsText = cityCats.length ? cityCats.join(', ') : 'MÃºsica, Culturales, Deportes, Conferencias';\r\n  botReply([{ text: `Perfecto â€” ahora busco eventos en ${city}. Â¿QuÃ© categorÃ­a te interesa? ${catsText}. Escribe la categorÃ­a.` }], 600);\r\n        return;\r\n      }\r\n\r\n      // default behavior (no selectedCity previously): show categories for chosen city\r\n      listCategories(city);\r\n      return;\r\n    }\r\n\r\n    if (intent.intent === 'choose_category') {\r\n      const rawCat = intent.category;\r\n      // find a valid category key in the currently selected city or pendingCity\r\n      const cityForLookup = selectedCity || pendingCity;\r\n      const validCat = cityForLookup ? findCategoryKeyForCity(cityForLookup, rawCat) : null;\r\n      if (validCat && cityForLookup) {\r\n        // reset pagination for this city|category\r\n        const key = `${cityForLookup}|${validCat}`;\r\n        setPages((p) => ({ ...p, [key]: 0 }));\r\n        setSelectedCategory(validCat);\r\n        setSelectedCity(cityForLookup);\r\n        showEvents(cityForLookup, validCat);\r\n      } else if (selectedCity && !validCat) {\r\n        // selected city exists but category not found there\r\n        const available = getCategoriesForCity(selectedCity);\r\n        const options = available.length ? available.concat(['Ver todos']) : ['MÃºsica', 'Culturales', 'Deportes', 'Conferencias'];\r\n        botReply([{ text: `No encontrÃ© la categorÃ­a solicitada en ${selectedCity}. Puedes elegir otra categorÃ­a: ${options.join(', ')}. Escribe la que prefieras.` }], 600);\r\n      } else {\r\n        const cities = getCities();\r\n        botReply([{ text: `Has pedido la categorÃ­a ${capitalizeFirst(rawCat)}. Primero, selecciona una ciudad: ${cities.join(', ')}. Escribe la ciudad.` }], 600);\r\n      }\r\n      return;\r\n    }\r\n    // fallback: use confidence to decide whether to clarify or perform a best-effort\r\n    if (confidence < 0.6) {\r\n      botReply([{ text: 'No estoy seguro de quÃ© quieres decir â€” Â¿Quieres que muestre ciudades, buscar por texto o ver ayuda? Escribe \"ver ciudades\", \"buscar <texto>\" o \"ayuda\".' }], 600);\r\n    } else {\r\n      // try a friendly fallback that asks a clarifying question\r\n      botReply([{ text: 'Â¿Quieres que muestre ciudades, busque por texto o te muestre ayuda? Escribe ver ciudades, buscar <texto> o ayuda.' }], 600);\r\n    }\r\n  }, [listCities, listCategories, pushMessage, selectedCity, showEvents]);\r\n\r\n  \r\n\r\n  // API requested: sendText, selectOption, resetConversation\r\n  const sendText = useCallback((text) => {\r\n    handleText(text);\r\n  }, [handleText]);\r\n\r\n  const selectOption = useCallback((type, value) => {\r\n    // type: 'city'|'category'|'action'|'showMore'\r\n    if (type === 'city') { selectCity(value); return; }\r\n    if (type === 'category') { selectCategory(value); return; }\r\n    if (type === 'action' && (value||'').toLowerCase().includes('volver')) { restart(); return; }\r\n      if (type === 'showMore' || (type === 'action' && (value||'').toLowerCase().includes('ver m'))) {\r\n      // advance pagination for current selection\r\n      const city = selectedCity;\r\n      const category = selectedCategory;\r\n      if (!city || !category) { botReply([{ text: 'Primero selecciona una ciudad y categorÃ­a. Escribe \"ver ciudades\" para ver la lista de ciudades.' }], 500); return; }\r\n      const key = `${city}|${category}`;\r\n      const cityData = eventsData[city] || {};\r\n      const list = cityData[category] || [];\r\n      const current = pages[key] || 0;\r\n      const next = current + PAGE_SIZE;\r\n      if (next >= list.length) {\r\n        botReply([{ text: `No hay mÃ¡s eventos en ${category} para ${city}. Puedes escribir otra categorÃ­a o ciudad, o \"volver\" para reiniciar.` }], 600);\r\n        return;\r\n      }\r\n      // advance page index then show next PAGE_SIZE items\r\n      setPages((p) => ({ ...p, [key]: next }));\r\n      // show events from next index\r\n      const slice = list.slice(next, next + PAGE_SIZE);\r\n      const items = [{ text: `AquÃ­ tienes mÃ¡s eventos en ${category} Â· ${city}:` }];\r\n      slice.forEach((ev) => items.push({ type: 'event', payload: { ...ev, fecha: formatDate(ev.fecha) } }));\r\n      items.push({ text: (next + PAGE_SIZE < list.length) ? 'Escribe \"ver mÃ¡s\" para seguir viendo eventos.' : 'No quedan mÃ¡s eventos en esta lista. Escribe otra categorÃ­a o ciudad, o \"volver\".' });\r\n      botReply(items, 700);\r\n      return;\r\n    }\r\n  }, [listCategories, pushMessage, showEvents, selectedCity, selectedCategory, pages, PAGE_SIZE, botReply]);\r\n\r\n  // helper functions local to hook\r\n  function capitalizeFirst(s) {\r\n    if (!s) return s;\r\n    return s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();\r\n  }\r\n\r\n  function normalizeString(s) {\r\n    if (!s) return '';\r\n    return s.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').trim();\r\n  }\r\n\r\n  function normalizeCityName(raw) {\r\n    if (!raw) return raw;\r\n    const r = raw.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n  if (r.startsWith('medell')) return 'MedellÃ­n';\r\n  if (r.startsWith('bogo')) return 'BogotÃ¡';\r\n  if (r.startsWith('cali')) return 'Cali';\r\n  if (r.startsWith('bucara')) return 'Bucaramanga';\r\n  if (r.startsWith('cart') || r.startsWith('cartag')) return 'Cartagena';\r\n  if (r.startsWith('barra') || r.startsWith('barran')) return 'Barranquilla';\r\n    return raw;\r\n  }\r\n\r\n  // find a category key in a city by comparing normalized strings (handles accents)\r\n  function findCategoryKeyForCity(city, catLike) {\r\n    if (!city || !catLike) return null;\r\n    const cityData = eventsData[city] || {};\r\n    const cats = Object.keys(cityData || {});\r\n    const target = catLike.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n    for (const k of cats) {\r\n      const nk = k.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\r\n      if (nk === target || nk.startsWith(target)) return k;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  const selectCity = useCallback((city) => {\r\n    if (!city) return;\r\n    setSelectedCity(city);\r\n    listCategories(city);\r\n  }, [listCategories]);\r\n\r\n  const selectCategory = useCallback((category) => {\r\n    if (!category) return;\r\n    const cityToUse = selectedCity || pendingCity;\r\n    if (!cityToUse) {\r\n      pushMessage('ia', 'Primero, elige una ciudad para buscar.');\r\n      listCities();\r\n      return;\r\n    }\r\n    // clear pendingCity after consuming\r\n    setPendingCity(null);\r\n    showEvents(cityToUse, category);\r\n  }, [selectedCity, pendingCity, pushMessage, listCities, showEvents]);\r\n\r\n  const restart = useCallback(() => {\r\n    setState('idle');\r\n    setSelectedCity(null);\r\n    setSelectedCategory(null);\r\n    setMessages([{ id: genId('msg'), sender: 'ia', text: 'Â¡Hola de nuevo! Dime en quÃ© ciudad buscas y preparo algunas opciones para ti.', time: new Date().toISOString() }]);\r\n  }, []);\r\n\r\n  const toggleOpen = useCallback(() => setOpen((o) => !o), []);\r\n\r\n  return {\r\n    open,\r\n    state,\r\n    selectedCity,\r\n    selectedCategory,\r\n    messages,\r\n    isTyping,\r\n    // API methods requested\r\n    sendText: sendText,\r\n    selectOption: selectOption,\r\n    resetConversation: restart,\r\n    toggleOpen,\r\n    // legacy actions object for UI compatibility\r\n    actions: {\r\n      pushMessage,\r\n      handleText,\r\n      listCities,\r\n      listCategories,\r\n      selectCity,\r\n      selectCategory,\r\n      showEvents,\r\n      restart,\r\n      toggleOpen,\r\n      // expose newer API on actions for backward compatibility\r\n      selectOption,\r\n      sendText,\r\n      resetConversation: restart,\r\n    },\r\n  };\r\n}\r\n\r\nexport default useChatBot;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}